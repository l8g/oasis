### 关卡管理模块详细设计文档

**功能概述**

关卡管理模块负责管理关卡的创建、加载、保存和进度管理。它处理关卡目标和进度的跟踪，实现关卡内的动态事件和突发情况处理。关卡管理模块在游戏整体中起着核心作用，决定了游戏的进程和挑战性，确保玩家在每个关卡中都能体验到设计好的游戏内容。

**类结构**

- **LevelManager**：管理关卡实例，负责关卡的创建、加载和保存
  - **属性**：
    - **levels**：List<Level> - 存储所有关卡实例的列表
  - **方法**：
    - **LoadLevel(levelId)**：Level - 加载指定ID的关卡
      - **使用场景**：当玩家选择进入关卡时调用，加载关卡的详细信息和配置。
      - **主要逻辑**：从存储中读取关卡数据，创建Level实例并初始化关卡状态。
    - **SaveLevel(levelId)**：void - 保存当前关卡的进度
      - **使用场景**：当玩家退出关卡或关卡结束时调用，保存当前关卡的进度和状态。
      - **主要逻辑**：将关卡的当前状态和进度保存到存储中。
    - **ResetLevel(levelId)**：void - 重置指定ID的关卡
      - **使用场景**：当玩家选择重新开始关卡时调用，重置关卡状态和进度。
      - **主要逻辑**：重置关卡数据，使其恢复到初始状态。
    - **TriggerEvent(eventId)**：void - 触发关卡内的动态事件
      - **使用场景**：当关卡内发生特定事件时调用，执行相应的动态事件。
      - **主要逻辑**：根据事件ID查找事件并执行其预定义的效果。

- **Level**：关卡类，包含关卡信息和配置
  - **属性**：
    - **id**：int - 关卡的唯一标识符
    - **name**：string - 关卡名称
    - **description**：string - 关卡描述
    - **zombieWaves**：List<ZombieWave> - 僵尸波次配置
    - **objectives**：List<Objective> - 关卡目标
    - **events**：List<Event> - 动态事件配置
  - **方法**：
    - **Start()**：void - 开始关卡
      - **使用场景**：当玩家开始关卡时调用，初始化关卡状态和配置。
      - **主要逻辑**：初始化关卡中的所有组件，准备关卡开始。
    - **End()**：void - 结束关卡
      - **使用场景**：当玩家完成或退出关卡时调用，记录关卡结果和状态。
      - **主要逻辑**：记录关卡完成状态，执行结束逻辑。
    - **Update()**：void - 更新关卡状态
      - **使用场景**：游戏运行过程中，定期调用此方法更新关卡状态和进度。
      - **主要逻辑**：更新僵尸波次、检查目标完成情况、处理动态事件。
    - **HandleEvent(eventId)**：void - 处理关卡内的动态事件
      - **使用场景**：当关卡内发生特定事件时调用，执行相应的事件逻辑。
      - **主要逻辑**：查找并执行事件逻辑，更新关卡状态。

- **ZombieWave**：僵尸波次配置类，包含每波次的僵尸生成信息
  - **属性**：
    - **waveNumber**：int - 波次编号
    - **zombieTypes**：List<string> - 该波次生成的僵尸类型列表
    - **spawnInterval**：float - 僵尸生成间隔时间

- **Objective**：关卡目标类，定义关卡的目标和完成条件
  - **属性**：
    - **description**：string - 目标描述
    - **isCompleted**：bool - 目标是否完成

- **Event**：动态事件类，定义关卡内的突发事件
  - **属性**：
    - **eventId**：int - 事件唯一标识符
    - **triggerCondition**：string - 事件触发条件
    - **effect**：string - 事件效果描述

**接口定义**

- **LoadLevel(levelId)**：int -> Level
  - 加载指定ID的关卡，返回关卡实例。
  - **使用场景**：当玩家选择进入关卡时调用。
  - **前置条件**：关卡ID有效且存在于存储中。
  - **预期结果**：成功加载关卡实例，并初始化关卡状态。

- **SaveLevel(levelId)**：int -> void
  - 保存当前关卡的进度。
  - **使用场景**：当玩家退出关卡或关卡结束时调用。
  - **前置条件**：关卡实例已存在且进度需要保存。
  - **预期结果**：成功保存当前关卡的进度到存储中。

- **ResetLevel(levelId)**：int -> void
  - 重置指定ID的关卡。
  - **使用场景**：当玩家选择重新开始关卡时调用。
  - **前置条件**：关卡ID有效且存在于存储中。
  - **预期结果**：成功重置关卡状态，使其恢复到初始状态。

- **TriggerEvent(eventId)**：int -> void
  - 触发关卡内的动态事件。
  - **使用场景**：当关卡内发生特定事件时调用。
  - **前置条件**：事件ID有效且存在于关卡事件列表中。
  - **预期结果**：成功执行事件效果，并更新关卡状态。

**数据流**

1. 玩家选择进入关卡时，系统调用LevelManager的LoadLevel方法，根据关卡ID加载关卡配置。
2. LevelManager将关卡实例添加到关卡列表中，并初始化关卡状态。
3. 游戏运行过程中，系统定期调用Level的Update方法，更新关卡状态和进度。
4. 当关卡内发生动态事件时，调用TriggerEvent方法，执行相应事件。
5. 玩家完成关卡目标或退出关卡时，系统调用SaveLevel方法，保存当前关卡进度。
6. 当玩家选择重新开始关卡时，系统调用ResetLevel方法，重置关卡状态和进度。

- **数据流示意图**：
  - 插入数据流动示意图，展示关卡加载、状态更新、事件触发和进度保存的全过程。

**详细描述**

- **加载关卡**：当玩家选择进入关卡时，系统调用LevelManager的LoadLevel方法。该方法根据关卡ID加载关卡配置，包括关卡名称、描述、僵尸波次、目标和动态事件等。加载完成后，关卡实例添加到关卡列表中，并初始化关卡状态。

- **保存关卡**：玩家完成关卡目标或退出关卡时，系统调用LevelManager的SaveLevel方法。该方法根据关卡ID保存当前关卡的进度，包括已完成的波次、剩余资源等。保存的数据用于玩家下次继续关卡。

- **重置关卡**：当玩家选择重新开始关卡时，系统调用LevelManager的ResetLevel方法。该方法根据关卡ID重置关卡状态和进度，使关卡恢复到初始状态，供玩家重新挑战。

- **关卡更新**：游戏运行过程中，系统定期调用Level的Update方法。该方法更新关卡状态，包括生成新的僵尸波次、检查目标完成情况等。每个关卡实例根据自身配置，执行相应的更新逻辑。

- **动态事件处理**：关卡内可能发生各种动态事件，例如天气变化、资源掉落、僵尸突袭等。当事件触发时，系统调用LevelManager的TriggerEvent方法。该方法根据事件ID执行相应的处理逻辑，例如生成新的敌人、改变环境状态等。

- **关卡目标设置**：关卡目标包括防御到指定波次、消灭特定数量的僵尸等。目标通过Level的objectives属性配置，并在Update方法中进行检查。完成目标后，关卡实例将更新状态，并触发相关奖励或下一波次的生成。

- **关键场景描述**：描述关卡在不同场景下的具体行为和处理逻辑，例如在生成僵尸波次时如何处理、在触发动态事件时的具体流程等。

**模块间交互**

- **与僵尸管理模块**：关卡管理模块通过调用ZombieManager的SpawnZombie方法生成僵尸波次，ZombieManager负责生成和管理僵尸。
- **与植物管理模块**：关卡管理模块更新关卡状态时，会检查植物的状态和位置，以确保植物在关卡中的正确表现。
- **与用户界面模块**：用户

界面显示关卡信息和进度，用户界面层调用关卡管理模块的接口，获取关卡信息并进行显示。

- **模块间交互示意图**：
  - 插入模块间交互示意图，展示关卡管理模块与其他模块的交互方式和数据传递过程。

